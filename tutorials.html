<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorials &mdash; Cyanure 0.2 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Benchmarks" href="benchmarks.html" />
    <link rel="prev" title="Preprocessing functions" href="pythonAPI/data_processing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Cyanure
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Welcome to Cyanure’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="welcome.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="welcome.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pythonAPI/pythonAPI.html">Python API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#examples-for-binary-classification">Examples for binary classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiclass-classification">Multiclass classification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cyanure</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorials</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorials.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many of the datasets I used are available <a class="reference external" href="http://pascal.inrialpes.fr/data2/mairal/data/">here</a>.  I am waiting for the authorization from Criteo before putting their dataset online as well in .npz format.</p>
</div>
<div class="section" id="examples-for-binary-classification">
<h2>Examples for binary classification<a class="headerlink" href="#examples-for-binary-classification" title="Permalink to this headline"></a></h2>
<p>The following code performs binary classification with <span class="math notranslate nohighlight">\(\ell_2\)</span>-regularized logistic regression, with no intercept, on the criteo dataset (21Gb, huge sparse matrix):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cyanure</span> <span class="k">as</span> <span class="nn">cyan</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#load criteo dataset 21Gb, n=45840617, p=999999</span>
<span class="n">dataY</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;criteo_y.npz&#39;</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="n">dataY</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">load_npz</span><span class="p">(</span><span class="s1">&#39;criteo_X.npz&#39;</span><span class="p">)</span>
<span class="c1">#normalize the rows of X in-place, without performing any copy</span>
<span class="n">cyan</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#declare a binary classifier for l2-logistic regression</span>
<span class="n">classifier</span><span class="o">=</span><span class="n">cyan</span><span class="o">.</span><span class="n">BinaryClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">,</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">)</span>
<span class="c1"># uses the auto solver by default, performs at most 500 epochs</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lambd</span><span class="o">=</span><span class="mf">0.1</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span><span class="n">it0</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Before we comment the previous choices, let us
run the above code on a regular three-years-old quad-core workstation with 32Gb of memory
(Intel Xeon CPU E5-1630 v4, 400$ retail price).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Matrix</span> <span class="n">X</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">45840617</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">999999</span>
<span class="o">*********************************</span>
<span class="n">Catalyst</span> <span class="n">Accelerator</span>
<span class="n">MISO</span> <span class="n">Solver</span>
<span class="n">Incremental</span> <span class="n">Solver</span> <span class="k">with</span> <span class="n">uniform</span> <span class="n">sampling</span>
<span class="n">Lipschitz</span> <span class="n">constant</span><span class="p">:</span> <span class="mf">0.250004</span>
<span class="n">Logistic</span> <span class="n">Loss</span> <span class="ow">is</span> <span class="n">used</span>
<span class="n">L2</span> <span class="n">regularization</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.456014</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">92.5784</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">14383.9</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.450885</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">227.593</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">1004.69</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.450728</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">367.939</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">6.50049</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.450724</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">502.954</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.068658</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.450724</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">643.323</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.00173208</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.450724</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">778.363</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.00173207</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.450724</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">909.426</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">9.36947e-05</span>
<span class="n">Time</span> <span class="n">elapsed</span> <span class="p">:</span> <span class="mf">928.114</span>
</pre></div>
</div>
<p>The solver used was <em>catalyst-miso</em>; the problem was solved up to
accuracy tol=0.001 in about 15mn after 35 epochs (without taking into account
the time to load the dataset from the hard drive). The regularization
parameter was chosen to be <span class="math notranslate nohighlight">\(\lambda=\frac{1}{10n}\)</span>, which is close to the
optimal one given by cross-validation.  Even though performing a grid search with
cross-validation would be more costly, it nevertheless shows that processing such
a large dataset does not necessarily require to massively invest in Amazon EC2 credits,
GPUs, or distributed computing architectures.</p>
<p>In the next example, we use the squared hinge loss with
<span class="math notranslate nohighlight">\(\ell_1\)</span>-regularization, choosing the regularization parameter such that the
obtained solution has about 10% non-zero coefficients.
We also fit an intercept. As shown below, the solution is obtained in 26s on a
laptop with a quad-core i7-8565U CPU (specifically a dell XPS 13 9380).:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cyanure</span> <span class="k">as</span> <span class="nn">cyan</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span>
<span class="c1">#load rcv1 dataset about 1Gb, n=781265, p=47152</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;rcv1.npz&#39;</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">];</span> <span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">())</span><span class="o">.</span><span class="n">T</span> <span class="c1"># n x p matrix, csr format</span>
<span class="c1">#normalize the rows of X in-place, without performing any copy</span>
<span class="n">cyan</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#declare a binary classifier for squared hinge loss + l1 regularization</span>
<span class="n">classifier</span><span class="o">=</span><span class="n">cyan</span><span class="o">.</span><span class="n">BinaryClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sqhinge&#39;</span><span class="p">,</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">)</span>
<span class="c1"># uses the auto solver by default, performs at most 500 epochs</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lambd</span><span class="o">=</span><span class="mf">0.000005</span><span class="p">,</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>which yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Matrix</span> <span class="n">X</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">781265</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">47152</span>
<span class="n">Memory</span> <span class="n">parameter</span><span class="p">:</span> <span class="mi">20</span>
<span class="o">*********************************</span>
<span class="n">QNing</span> <span class="n">Accelerator</span>
<span class="n">MISO</span> <span class="n">Solver</span>
<span class="n">Incremental</span> <span class="n">Solver</span> <span class="k">with</span> <span class="n">uniform</span> <span class="n">sampling</span>
<span class="n">Lipschitz</span> <span class="n">constant</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Squared</span> <span class="n">Hinge</span> <span class="n">Loss</span> <span class="ow">is</span> <span class="n">used</span>
<span class="n">L1</span> <span class="n">regularization</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0915524</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">7.33038</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.387338</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0915441</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">15.524</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.00426003</span>
<span class="n">Epoch</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0915441</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">25.738</span>
<span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000312145</span>
<span class="n">Time</span> <span class="n">elapsed</span> <span class="p">:</span> <span class="mf">26.0225</span>
<span class="n">Total</span> <span class="n">additional</span> <span class="n">line</span> <span class="n">search</span> <span class="n">steps</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">Total</span> <span class="n">skipping</span> <span class="n">l</span><span class="o">-</span><span class="n">bfgs</span> <span class="n">steps</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="multiclass-classification">
<h2>Multiclass classification<a class="headerlink" href="#multiclass-classification" title="Permalink to this headline"></a></h2>
<p>Let us now do something a bit more involved and perform multinomial logistic regression on the
<em>ckn_mnist</em> dataset (10 classes, n=60000, p=2304, dense matrix), with multi-task group lasso regularization,
using the same laptop as previously, and choosing a regularization parameter that yields a solution with 5% non zero coefficients.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cyanure.estimators</span> <span class="kn">import</span> <span class="n">MultiClassifier</span>
 <span class="kn">from</span> <span class="nn">cyanure.data_processing</span> <span class="kn">import</span> <span class="n">preprocess</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


 <span class="c1">#load ckn_mnist dataset 10 classes, n=60000, p=2304</span>
 <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;dataset/ckn_mnist.npz&#39;</span><span class="p">)</span>
 <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
 <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
 <span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>

 <span class="c1">#center and normalize the rows of X in-place, without performing any copy</span>
 <span class="n">preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">centering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 <span class="c1">#declare a multinomial logistic classifier with group Lasso regularization</span>
 <span class="n">classifier</span><span class="o">=</span><span class="n">MultiClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;multiclass-logistic&#39;</span><span class="p">,</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1l2&#39;</span><span class="p">,</span><span class="n">lambda_1</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span><span class="n">duality_gap_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="c1"># uses the auto solver by default, performs at most 500 epochs</span>
 <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>which produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Info</span> <span class="p">:</span> <span class="n">Matrix</span> <span class="n">X</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2304</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Memory</span> <span class="n">parameter</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Info</span> <span class="p">:</span> <span class="o">*********************************</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">QNing</span> <span class="n">Accelerator</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">MISO</span> <span class="n">Solver</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Incremental</span> <span class="n">Solver</span>
<span class="n">Info</span> <span class="p">:</span> <span class="k">with</span> <span class="n">uniform</span> <span class="n">sampling</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Lipschitz</span> <span class="n">constant</span><span class="p">:</span> <span class="mf">0.25</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Multiclass</span> <span class="n">logistic</span> <span class="n">Loss</span> <span class="ow">is</span> <span class="n">used</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Mixed</span> <span class="n">L1</span><span class="o">-</span><span class="n">L2</span> <span class="n">norm</span> <span class="n">regularization</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.334992</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">39.9396</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.0922704</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.332324</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">75.1757</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.0268615</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.332051</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">103.535</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.0155829</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.331984</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">138.484</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.0049912</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.331973</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">174.755</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.00232949</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.331972</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">207.706</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.00141096</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Epoch</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="n">primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.331972</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">235.578</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Best</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000769221</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Time</span> <span class="n">elapsed</span> <span class="p">:</span> <span class="mf">236.065</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Total</span> <span class="n">additional</span> <span class="n">line</span> <span class="n">search</span> <span class="n">steps</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Total</span> <span class="n">skipping</span> <span class="n">l</span><span class="o">-</span><span class="n">bfgs</span> <span class="n">steps</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Learning the multiclass classifier took about 3mn and 35s. To conclude, we provide a last more classical example
of learning l2-logistic regression classifiers on the same dataset, in a one-vs-all fashion.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cyanure.estimators</span> <span class="kn">import</span> <span class="n">MultiClassifier</span>
<span class="kn">from</span> <span class="nn">cyanure.data_processing</span> <span class="kn">import</span> <span class="n">preprocess</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="c1">#load ckn_mnist dataset 10 classes, n=60000, p=2304</span>
<span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;dataset/ckn_mnist.npz&#39;</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>

<span class="c1">#center and normalize the rows of X in-place, without performing any copy</span>
<span class="n">preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">centering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#declare a multinomial logistic classifier with group Lasso regularization</span>
<span class="n">classifier</span><span class="o">=</span><span class="n">MultiClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">,</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span><span class="n">lambda_1</span><span class="o">=</span><span class="mf">0.01</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">&quot;ovr&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># uses the auto solver by default, performs at most 500 epochs</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, the 10 classifiers are learned in parallel using the four cpu cores
(still on the same laptop), which gives the following output after about 1mn:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Info</span> <span class="p">:</span> <span class="n">Matrix</span> <span class="n">X</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2304</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">7</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">30</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">20.3963</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0105672</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000304014</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">4</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">30</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">22.6081</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0087735</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000198454</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">0</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">35</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">23.8481</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.00577782</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000326908</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">8</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">30</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">22.1619</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0150245</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000373297</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">5</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">30</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">20.5889</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.00900673</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000429762</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">35</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">24.4471</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.00487408</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000178935</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">9</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">25</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">19.4686</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0161172</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000812255</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">6</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">30</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">21.1479</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.00687949</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000246356</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">2</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">35</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">20.7598</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0104325</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000125021</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Solver</span> <span class="mi">3</span> <span class="n">has</span> <span class="n">terminated</span> <span class="n">after</span> <span class="mi">25</span> <span class="n">epochs</span> <span class="ow">in</span> <span class="mf">10.4471</span> <span class="n">seconds</span>
<span class="n">Info</span> <span class="p">:</span>    <span class="n">Primal</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">0.0080502</span><span class="p">,</span> <span class="n">relative</span> <span class="n">duality</span> <span class="n">gap</span><span class="p">:</span> <span class="mf">0.000679728</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Time</span> <span class="k">for</span> <span class="n">the</span> <span class="n">one</span><span class="o">-</span><span class="n">vs</span><span class="o">-</span><span class="nb">all</span> <span class="n">strategy</span>
<span class="n">Info</span> <span class="p">:</span> <span class="n">Time</span> <span class="n">elapsed</span> <span class="p">:</span> <span class="mf">81.5488</span>
</pre></div>
</div>
<p>Note that the toolbox also provides the classes LinearSVC and LogisticRegression that are near-compatible with scikit-learn’s API.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pythonAPI/data_processing.html" class="btn btn-neutral float-left" title="Preprocessing functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="benchmarks.html" class="btn btn-neutral float-right" title="Benchmarks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Julien Mairal.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>